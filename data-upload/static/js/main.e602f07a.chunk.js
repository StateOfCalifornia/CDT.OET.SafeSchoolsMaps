(this["webpackJsonpdata-upload"]=this["webpackJsonpdata-upload"]||[]).push([[0],{156:function(e,t){},177:function(e){e.exports=JSON.parse('{"env":"prod","dev":{"featureServiceURL":"https://services3.arcgis.com/uknczv4rpevve42E/arcgis/rest/services/Trailer_Bill_Districts_Upload_STG/FeatureServer/0","templateUrl":"https://california.maps.arcgis.com/sharing/rest/content/items/bf81501c7f5a415499543f5c2ecd6790/data"},"prod":{"featureServiceURL":"https://services3.arcgis.com/uknczv4rpevve42E/ArcGIS/rest/services/TrailerBillDistricts/FeatureServer/0","templateUrl":"https://california.maps.arcgis.com/sharing/rest/content/items/2d458e6ee04b494a9747271ad8ffcc08/data"},"isValidField":"IsValid","isValidValue":"Valid","schoolNameFieldEsri":"school_name","schoolNameFieldExcel":"School","dataSheetName":"Data Entry","version":{"sheet":"Version","major":"Major","minor":"Minor","date":"Last Updated","message":"Message"},"authInfo":{"clientId":"KZryzIWRkPmHUGlJ","portalUrl":"https://california-hub.maps.arcgis.com/sharing","popup":false}}')},240:function(e,t){},241:function(e,t){},265:function(e,t,n){},266:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(22),i=n.n(c),o=n(19),s=n.n(o),l=n(26),u=n(23),d=n(84),f=n(64),h=n.n(f),j=n(271),p=n(270),b=n(269),x=(n(6),function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r,a,c,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.rows,r=t.fields,a=t.userSession,c=t.featureLayerUrl,e.next=3,Object(b.a)({authentication:a,url:c,features:n.map((function(e){var t={};return r.forEach((function(n){t[n.name]=e[n.alias]})),{attributes:t}}))});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var O,g,v,m,w,S,y,k,E,_,C,D,B,L,U,F,P,T,I,A,M,R,V,N,z,Y,H=n(29),G=n.n(H),J=n(171),W=n.n(J),q=n(27),K=n.n(q),Z=n(13),Q=n(8),X=Q.default.div(O||(O=Object(Z.a)(["\n  height: 60px;\n  padding: 10px 0px;\n  background: ",";\n  box-sizing: border-box;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),$=Q.default.div(g||(g=Object(Z.a)(["\n  display: flex;\n  align-items: center;\n  margin-right: 25px;\n  & img {\n    height: 70px;\n    margin-right: 15px;\n    background: #ffffff;\n    padding-left: 15px;\n  }\n  & h1 {\n    margin: 0;\n    font-size: 1.5em;\n    font-weight: 300;\n    color: ",";\n  }\n"])),(function(e){return e.theme.palette.white})),ee=Q.default.img(v||(v=Object(Z.a)(["\n  background: "," !important;\n  height: 50px !important;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),te=Object(Q.default)(h.a)(m||(m=Object(Z.a)(["\n  color: ",";\n  height: auto !important;\n  background-color: ",";\n"])),(function(e){return e.theme.palette.white}),(function(e){return e.theme.palette.lightBlue})),ne=n(5),re=function(e){var t=e.account,n=t.user,r=t.portal,a=e.attemptLogout,c=e.isDev;return Object(ne.jsxs)(X,{children:[Object(ne.jsxs)($,{children:[Object(ne.jsx)(ee,{src:"https://california.maps.arcgis.com/sharing/rest/content/items/eabecb26ec754b849c44175495e31e66/data",alt:"Header Logo"}),Object(ne.jsx)("h1",{children:"CA Safe Schools - Data Import".concat(c?" DEVELOPMENT":"")})]}),Object(ne.jsx)(te,{user:n,portal:r,hideSwitchAccount:!0,onRequestSignOut:a})]})},ae=a.a.createContext({loading:void 0,setLoading:void 0,error:void 0,setError:void 0,data:void 0,setData:void 0,versionInfo:void 0,setVersionInfo:void 0,config:void 0}),ce=n(41),ie=n.n(ce),oe=n(68),se=n(53),le=n.n(se),ue=Q.default.div(w||(w=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n"]))),de=Q.default.div(S||(S=Object(Z.a)(["\n  margin-top: 15px;\n"]))),fe=Object(Q.default)(le.a)(y||(y=Object(Z.a)(["\n  border: 1px solid ",";\n  max-width: unset;\n  box-shadow: unset;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),he=(Q.default.div(k||(k=Object(Z.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding-left: 10px;\n  background-color: ",";\n"])),(function(e){return e.index%2?e.theme.palette.Brand_Blue_100:""})),Q.default.div(E||(E=Object(Z.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background-color: ",";\n  color: #ffffff;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),Object(Q.default)(oe.a)(_||(_=Object(Z.a)(["\n  border: 1px solid ",";\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),n(18)),je=n(77),pe=n(79),be=n.n(pe),xe=n(66),Oe=n.n(xe),ge=n(174),ve=n.n(ge),me=Q.default.div(C||(C=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n\n  height: 100%;\n"]))),we=Object(Q.default)(G.a)(D||(D=Object(Z.a)(["\n  width: 200px;\n"]))),Se=function(e){e.onVersionError;var t=Object(r.useContext)(ae),n=t.setLoading,a=t.data,c=t.versionInfo,i=t.setData,o=t.setError,d=t.config,f=Object(r.useState)([]),h=Object(u.a)(f,2),j=h[0],p=h[1],b=Object(r.useState)(!1),x=Object(u.a)(b,2),O=x[0],g=x[1];Object(r.useEffect)((function(){i(j.filter((function(e){return e[d.isValidField]===d.isValidValue})))}),[d,j,i]);var v=function(){var e=Object(l.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(null),i([]),n(!0),g(!1),(r=new Promise((function(e,n){try{var r=new FileReader;t.target.files&&t.target.files.length||e(null),r.readAsArrayBuffer(t.target.files[0]),r.onload=function(t){var n=t.target.result,r=ie.a.read(n,{type:"buffer",cellDates:!0,dateNF:"YYYY-MM-DD"});try{var a=r.Sheets[d.version.sheet],i=ie.a.utils.sheet_to_json(a)[0],o=d.version.major;c[o]!==i[o]&&e({versionError:!0})}catch(f){e({versionError:!0})}var s=r.SheetNames[0],l=r.Sheets[s],u=ie.a.utils.sheet_to_json(l).filter((function(e){return e[d.schoolNameFieldExcel]}));e(u)},r.onerror=function(e){n(e)}}catch(a){n(a)}}))).then((function(e){n(!1),e?e.versionError?g(!0):p(e):o("Error Processing File")})),r.catch((function(e){console.error(e),o("Error Processing File")}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m="The uploaded file contains valid data for ".concat(a.length," of the ").concat(j.length," schools\n   in the district. Click Next to submit.");return Object(ne.jsxs)(ue,{children:[Object(ne.jsx)(je.CalciteH2,{children:"Upload & Review"}),Object(ne.jsx)(he.CalciteP,{children:"Upload your populated Excel document. Only valid rows will be submitted."}),Object(ne.jsx)(ve.a,{accept:".xlsx,.xls",onChange:v}),Object(ne.jsx)(he.CalciteP,{style:{paddingTop:"10px"},children:a.length?m:""}),O?Object(ne.jsxs)(fe,{icon:Object(ne.jsx)(be.a,{size:24}),children:[Object(ne.jsx)(se.AlertTitle,{children:"Invalid Excel File"}),Object(ne.jsx)(se.AlertMessage,{children:"The file uploaded does not match the current version of the template. Please download the latest, populate, and upload again."}),Object(ne.jsx)(de,{children:Object(ne.jsx)(we,{href:d[d.env].templateUrl,download:"CASchools_District_DataTemplate.xlsx",icon:Object(ne.jsx)(Oe.a,{size:16}),children:"Download"})})]}):""]})},ye=n(67),ke=n.n(ye),Ee=Q.default.div(B||(B=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  width: 80%;\n  max-width: 800px;\n  margin: 8% auto;\n  border: 2px solid #1f2574;\n  box-shadow: 0px 0px 8px 2px rgb(10 10 10 / 25%);\n"]))),_e=Q.default.div(L||(L=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  height: 100%;\n  padding: 36px;\n"]))),Ce=Q.default.div(U||(U=Object(Z.a)(["\n  width: calc(100% - 4rem);\n  background: ",";\n  padding: 2rem;\n"])),(function(e){return e.theme.palette.lightestGray})),De=Object(Q.default)(ye.ModalActions)(F||(F=Object(Z.a)(["\n  justify-content: space-between;\n"]))),Be=n(175),Le=n.n(Be),Ue=function(e){var t=e.userSession,n=Object(r.useContext)(ae),a=n.setVersionInfo,c=n.versionInfo,i=n.setLoading,o=n.setError,u=n.config;return Object(r.useEffect)((function(){var e=function(){var e=Object(l.a)(s.a.mark((function e(){var n,r,c,l,d,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(u[u.env].templateUrl,"?token=").concat(t.token));case 3:return n=e.sent,e.next=6,n.arrayBuffer();case 6:r=e.sent,c=ie.a.read(r,{type:"buffer",cellDates:!0,dateNF:"YYYY-MM-DD"}),l=u.version.sheet,c.Sheets.hasOwnProperty(l)?(d=c.Sheets[l],f=ie.a.utils.sheet_to_json(d),a(f[0])):o("Sheet ".concat(l," not found in workbook")),i(!1),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),o("Unable to verify Template Version"),i(!1);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();c||(i(!0),e())}),[a,u,o,i,t,c]),c?Object(ne.jsxs)(me,{children:[Object(ne.jsx)(he.CalciteH2,{children:"Download Template"}),Object(ne.jsx)(he.CalciteP,{children:"Download Excel template. Select your county and district, then populate school data."}),c[u.version.message]?Object(ne.jsx)(he.CalciteP,{children:c[u.version.message]}):"",Object(ne.jsx)(he.CalciteP,{children:"Last Updated: ".concat(Le()(c[u.version.date]).format("LL"))}),Object(ne.jsx)(we,{href:u[u.env].templateUrl,download:"CASchools_District_DataTemplate.xlsx",icon:Object(ne.jsx)(Oe.a,{size:16}),children:"Download"})]}):""},Fe=Q.default.div(P||(P=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n"]))),Pe=n(78),Te=n.n(Pe),Ie=n(176),Ae=n.n(Ie),Me=Q.default.div(T||(T=Object(Z.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n"]))),Re=Q.default.div(I||(I=Object(Z.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding-left: 10px;\n  background-color: ",";\n  color: ",";\n"])),(function(e){return e.index%2?e.theme.palette.lightBlue:""}),(function(e){return e.index%2?e.theme.palette.white:""})),Ve=(Q.default.div(A||(A=Object(Z.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background-color: ",";\n  color: #ffffff;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),Object(Q.default)(oe.a)(M||(M=Object(Z.a)(["\n  border: 1px solid ",";\n"])),(function(e){return e.theme.palette.Brand_Blue_200}))),Ne=function(e){var t=e.schools,n=e.schoolField;return Object(ne.jsx)(Me,{children:t.length?Object(ne.jsx)(Ve,{height:Math.min(200,40*t.length),overscanRowCount:10,rowCount:t.length,rowHeight:40,rowRenderer:function(e){var r=e.index,a=(e.isScrolling,e.key),c=e.style,i=t[r];return Object(ne.jsx)(Re,{style:c,index:r,children:i[n]},a)},width:600}):""})},ze=function(e){var t=e.results,n=Object(r.useContext)(ae),a=n.config,c=n.data,i=t.addResults,o=[];i.forEach((function(e,t){e.success||o.push(c[t])}));var s=o.length?"There was an error submitting ".concat(o.length," of ").concat(i.length," schools. The below schools were not added."):null;return s?Object(ne.jsxs)(Fe,{children:[Object(ne.jsx)(Ae.a,{size:100,color:"red",style:{margin:"auto"}}),Object(ne.jsx)(he.CalciteH3,{children:"Error"}),Object(ne.jsx)(he.CalciteP,{children:s}),Object(ne.jsx)(Ne,{schools:o,schoolField:a.schoolNameFieldEsri})]}):Object(ne.jsxs)(Fe,{style:{alignItems:"center"},children:[Object(ne.jsx)(Te.a,{size:100,color:"green",style:{margin:"auto"}}),Object(ne.jsx)(he.CalciteH3,{children:"Success! All ".concat(i.length," schools updated.")})]})},Ye=function(e){var t=e.account,n=e.appConfig,a=e.attemptLogout,c=Object(r.useState)(!1),i=Object(u.a)(c,2),o=i[0],d=i[1],f=Object(r.useState)(null),h=Object(u.a)(f,2),b=h[0],O=h[1],g=Object(r.useState)([]),v=Object(u.a)(g,2),m=v[0],w=v[1],S=Object(r.useState)(null),y=Object(u.a)(S,2),k=y[0],E=y[1],_=Object(r.useState)([]),C=Object(u.a)(_,2),D=C[0],B=C[1],L=Object(r.useState)(1),U=Object(u.a)(L,2),F=U[0],P=U[1],T=Object(r.useState)(null),I=Object(u.a)(T,2),A=I[0],M=I[1],R=Object(r.useMemo)((function(){return new j.a(t)}),[t]);Object(r.useEffect)((function(){var e=function(){var e=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(p.a)({authentication:R,url:n[n.env].featureServiceURL});case 3:(t=e.sent)&&t.fields&&B(t.fields.filter((function(e){return m[0].hasOwnProperty(e.alias)}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),O("Error Saving Data. (Fields)");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();m.length&&e()}),[m,R,n]);var V=function(){var e=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.next=3,x({rows:m,fields:D,userSession:R,featureLayerUrl:n[n.env].featureServiceURL});case 3:t=e.sent,M(t),P(F+1),d(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ne.jsx)(ae.Provider,{value:{loading:o,setLoading:d,error:b,setError:O,data:m,setData:w,versionInfo:k,setVersionInfo:E,config:n},children:Object(ne.jsxs)("div",{children:[Object(ne.jsx)(re,{account:t,attemptLogout:a,isDev:"dev"===n.env}),Object(ne.jsxs)(Ee,{children:[Object(ne.jsx)(Ce,{children:Object(ne.jsxs)(K.a,{currentStep:F,children:[Object(ne.jsxs)(q.Step,{error:b&&1===F,children:[Object(ne.jsx)(q.StepTitle,{children:"Download"}),Object(ne.jsx)(q.StepDescription,{children:b&&1===F?b:"Download the Excel template to report school data."})]}),Object(ne.jsxs)(q.Step,{error:b&&2===F,children:[Object(ne.jsx)(q.StepTitle,{children:"Upload"}),Object(ne.jsx)(q.StepDescription,{children:b&&2===F?b:"Upload the excel template populated with your schools information."})]}),Object(ne.jsxs)(q.Step,{children:[Object(ne.jsx)(q.StepTitle,{children:"Summary"}),Object(ne.jsx)(q.StepDescription,{children:"Summary of your submitted school data."})]})]})}),Object(ne.jsxs)(_e,{children:[o&&Object(ne.jsx)(W.a,{sizeRatio:2,style:{position:"absolute",top:"30%",left:"50%"}},"uploadLoader"),1===F&&Object(ne.jsx)(Ue,{versionInfo:n.version,userSession:R}),2===F&&Object(ne.jsx)(Se,{}),3===F&&Object(ne.jsx)(ze,{results:A})]}),Object(ne.jsx)(De,{children:Object(ne.jsxs)("div",{children:[2===F?Object(ne.jsx)(G.a,{clear:!0,onClick:function(){P(F-1),O(null)},style:{marginRight:".5rem"},children:"Previous"}):"",Object(ne.jsx)(G.a,{disabled:2===F&&(!m||!m.length)||Boolean(b),onClick:function(){1===F?P(F+1):2===F?V():(w([]),P(1))},children:["Next","Submit","Restart"][F-1]})]})})]})]})})},He=n.p+"static/media/splashBackground.5204fcdc.jpg",Ge=Q.default.div(R||(R=Object(Z.a)(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  background: url(",") center/cover\n    no-repeat;\n"])),(function(e){return e.error?"":He})),Je=Object(Q.default)(ke.a)(V||(V=Object(Z.a)(["\n  width: 350px;\n"]))),We=Q.default.div(N||(N=Object(Z.a)(["\n  text-align: center;\n"]))),qe=Q.default.img(z||(z=Object(Z.a)(["\n  width: 177px;\n"]))),Ke=Object(Q.default)(G.a)(Y||(Y=Object(Z.a)(["\n  margin-top: 1rem;\n  background-color: #1b449d;\n"]))),Ze=function(e){var t=e.attemptLogin;return Object(ne.jsx)(Ge,{children:Object(ne.jsx)(Je,{open:!0,appElement:document.body,overlayStyle:{background:"unset"},children:Object(ne.jsxs)(We,{children:[Object(ne.jsx)(qe,{src:"https://california.maps.arcgis.com/sharing/rest/content/items/eabecb26ec754b849c44175495e31e66/data",alt:"App Logo"}),Object(ne.jsx)(he.CalciteP,{children:"Login to upload school data."}),Object(ne.jsx)(Ke,{fullWidth:!0,onClick:t,children:"Proceed to Login"})]})})})},Qe=function(e){var t=e.config,n=Object(d.a)(Object(d.a)({},t.authInfo),{redirectUri:window.location.href}),a=Object(f.useAccountManager)(n),c=a.accountManagerState,i=a.addAccount,o=a.logoutAccount,h=c.active,b=c.accounts,x=Object(r.useState)(null),O=Object(u.a)(x,2),g=O[0],v=O[1];Object(r.useEffect)((function(){var e=function(){var e=Object(l.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(p.a)({authentication:new j.a(b[h]),url:t[t.env].featureServiceURL});case 3:(n=e.sent)&&n.fields&&v(!0),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),v(!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();h&&b[h]&&b[h].session&&e()}),[b,h,t]);var m=function(){i(n)};return h&&b[h]&&b[h].session&&null!==g?g?Object(ne.jsx)(Ye,{appConfig:t,account:b[h],userSession:new j.a(b[h].session),attemptLogout:function(){o(b[h])}}):(o(b[h]),Object(ne.jsx)(Ze,{attemptLogin:m})):Object(ne.jsx)(Ze,{attemptLogin:m})},Xe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,272)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))},$e=(n(265),n(20)),et=n.n($e),tt=n(177),nt=$e.CalciteTheme;nt.palette.Brand_Blue_200="#1f2574",nt.palette.blue="#1f2574",nt.palette.lightBlue="#5258A7",nt.palette.darkBlue="#5258A7",i.a.render(Object(ne.jsx)(a.a.StrictMode,{children:Object(ne.jsx)(et.a,{children:Object(ne.jsx)(Qe,{config:tt})})}),document.getElementById("root")),Xe()}},[[266,1,2]]]);
//# sourceMappingURL=main.e602f07a.chunk.js.map