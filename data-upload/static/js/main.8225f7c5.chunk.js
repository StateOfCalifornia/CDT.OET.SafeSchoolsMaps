(this["webpackJsonpdata-upload"]=this["webpackJsonpdata-upload"]||[]).push([[0],{151:function(e,t){},238:function(e,t){},239:function(e,t){},256:function(e,t,n){},257:function(e,t,n){"use strict";n.r(t);var c=n(20),a=n.n(c),r=n(29),i=n(1),o=n.n(i),l=n(22),s=n.n(l),u=n(79),d=n(62),f=n.n(d),h=n(262),j=n(30),p=n(261),b=n(260),x=n(6),g=function(){var e=Object(r.a)(a.a.mark((function e(t){var n,c,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.rows,c=t.fields,r=t.userSession,i=t.featureLayerUrl,e.next=3,Object(b.a)({authentication:r,url:i,features:n.map((function(e){var t={};return c.forEach((function(n){t[n.name]=e[n.alias]})),{attributes:t}}))});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function O(e,t){return new Promise((function(n,c){Object(x.c)(e,{httpMethod:"GET",params:t}).then((function(e){return n(e)})).catch((function(e){return c(e)}))}))}var m,v,w,y,S,k,C,B,L,_,D,E,P,A,F,T,U,R,M,z,H,N,I,Y,V=n(27),G=n.n(V),J=n(165),q=n.n(J),W=n(25),K=n.n(W),Q=n(13),X=n(9),Z=X.default.div(m||(m=Object(Q.a)(["\n  height: 60px;\n  padding: 10px 0px;\n  background: ",";\n  box-sizing: border-box;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),$=X.default.div(v||(v=Object(Q.a)(["\n  display: flex;\n  align-items: center;\n  margin-right: 25px;\n  & img {\n    height: 70px;\n    margin-right: 15px;\n    background: #ffffff;\n    padding-left: 15px;\n  }\n  & h1 {\n    margin: 0;\n    font-size: 1.5em;\n    font-weight: 300;\n    color: ",";\n  }\n"])),(function(e){return e.theme.palette.white})),ee=X.default.img(w||(w=Object(Q.a)(["\n  background: "," !important;\n  height: 50px !important;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),te=Object(X.default)(f.a)(y||(y=Object(Q.a)(["\n  color: ",";\n  height: auto !important;\n  background-color: ",";\n"])),(function(e){return e.theme.palette.white}),(function(e){return e.theme.palette.lightBlue})),ne=n(5),ce=function(e){var t=e.account,n=t.user,c=t.portal,a=e.attemptLogout;return Object(ne.jsxs)(Z,{children:[Object(ne.jsxs)($,{children:[Object(ne.jsx)(ee,{src:"https://california.maps.arcgis.com/sharing/rest/content/items/eabecb26ec754b849c44175495e31e66/data",alt:"Header Logo"}),Object(ne.jsx)("h1",{children:"CA Safe Schools - Data Import"})]}),Object(ne.jsx)(te,{user:n,portal:c,hideSwitchAccount:!0,onRequestSignOut:a})]})},ae=n(166),re=n.n(ae),ie=o.a.createContext({loading:void 0,setLoading:void 0,error:void 0,setError:void 0,data:void 0,setData:void 0,config:void 0}),oe=n(78),le=n.n(oe),se=n(65),ue=X.default.div(S||(S=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n"]))),de=(X.default.div(k||(k=Object(Q.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding-left: 10px;\n  background-color: ",";\n"])),(function(e){return e.index%2?e.theme.palette.Brand_Blue_100:""})),X.default.div(C||(C=Object(Q.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background-color: ",";\n  color: #ffffff;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),Object(X.default)(se.a)(B||(B=Object(Q.a)(["\n  border: 1px solid ",";\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),n(19)),fe=n(73),he=function(){var e=Object(i.useContext)(ie),t=e.setLoading,n=e.data,c=e.setData,o=e.setError,l=e.config,s=Object(i.useState)([]),u=Object(j.a)(s,2),d=u[0],f=u[1];Object(i.useEffect)((function(){c(d.filter((function(e){return e[l.isValidField]===l.isValidValue})))}),[l,d,c]);var h=function(){var e=Object(r.a)(a.a.mark((function e(n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(null),c([]),t(!0),(r=new Promise((function(e,t){try{var c=new FileReader;c.readAsArrayBuffer(n.target.files[0]),c.onload=function(t){var n=t.target.result,c=le.a.read(n,{type:"buffer",cellDates:!0,dateNF:"YYYY-MM-DD"}),a=c.SheetNames[0],r=c.Sheets[a],i=le.a.utils.sheet_to_json(r).filter((function(e){return e[l.schoolNameFieldExcel]}));e(i)},c.onerror=function(e){t(e)}}catch(a){t(a)}}))).then((function(e){t(!1),f(e)})),r.catch((function(e){console.error(e),o("Error Processing File")}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p="The uploaded file contains valid data for ".concat(n.length," of the ").concat(d.length," schools\n   in the district. Click Next to submit.");return Object(ne.jsxs)(ue,{children:[Object(ne.jsx)(fe.CalciteH2,{children:"Upload & Review"}),Object(ne.jsx)(de.CalciteP,{children:"Upload your populated Excel document. Only valid rows will be submitted."}),Object(ne.jsx)(re.a,{accept:".xlsx,.xls",onChange:h}),Object(ne.jsx)(de.CalciteP,{style:{paddingTop:"10px"},children:n.length?p:""})]})},je=n(64),pe=n.n(je),be=X.default.div(L||(L=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  width: 80%;\n  max-width: 800px;\n  margin: 8% auto;\n  border: 2px solid #1f2574;\n  box-shadow: 0px 0px 8px 2px rgb(10 10 10 / 25%);\n"]))),xe=X.default.div(_||(_=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  height: 100%;\n  padding: 36px;\n"]))),ge=X.default.div(D||(D=Object(Q.a)(["\n  width: calc(100% - 4rem);\n  background: ",";\n  padding: 2rem;\n"])),(function(e){return e.theme.palette.lightestGray})),Oe=Object(X.default)(je.ModalActions)(E||(E=Object(Q.a)(["\n  justify-content: space-between;\n"]))),me=X.default.div(P||(P=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n\n  height: 100%;\n"]))),ve=Object(X.default)(G.a)(A||(A=Object(Q.a)(["\n  width: 200px;\n"]))),we=n(169),ye=n.n(we),Se=function(e){var t=e.fileUrl;return Object(ne.jsxs)(me,{children:[Object(ne.jsx)(de.CalciteH2,{children:"Download Template"}),Object(ne.jsx)(de.CalciteP,{children:"Download Excel template. Select your county and district, then populate school data."}),Object(ne.jsx)(ve,{href:t,download:"CASchools_District_DataTemplate.xlsx",onClick:function(){return console.log("clicked")},icon:Object(ne.jsx)(ye.a,{size:16}),children:"Download"})]})},ke=X.default.div(F||(F=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n"]))),Ce=n(170),Be=n.n(Ce),Le=n(171),_e=n.n(Le),De=X.default.div(T||(T=Object(Q.a)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n"]))),Ee=X.default.div(U||(U=Object(Q.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding-left: 10px;\n  background-color: ",";\n  color: ",";\n"])),(function(e){return e.index%2?e.theme.palette.lightBlue:""}),(function(e){return e.index%2?e.theme.palette.white:""})),Pe=(X.default.div(R||(R=Object(Q.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background-color: ",";\n  color: #ffffff;\n"])),(function(e){return e.theme.palette.Brand_Blue_200})),Object(X.default)(se.a)(M||(M=Object(Q.a)(["\n  border: 1px solid ",";\n"])),(function(e){return e.theme.palette.Brand_Blue_200}))),Ae=function(e){var t=e.schools,n=e.schoolField;return Object(ne.jsx)(De,{children:t.length?Object(ne.jsx)(Pe,{height:Math.min(200,40*t.length),overscanRowCount:10,rowCount:t.length,rowHeight:40,rowRenderer:function(e){var c=e.index,a=(e.isScrolling,e.key),r=e.style,i=t[c];return Object(ne.jsx)(Ee,{style:r,index:c,children:i[n]},a)},width:600}):""})},Fe=function(e){var t=e.results,n=Object(i.useContext)(ie),c=n.config,a=n.data,r=t.addResults,o=[];r.forEach((function(e,t){e.success||o.push(a[t])}));var l=o.length?"There was an error submitting ".concat(o.length," of ").concat(r.length," schools. The below schools were not added."):null;return l?Object(ne.jsxs)(ke,{children:[Object(ne.jsx)(_e.a,{size:100,color:"red",style:{margin:"auto"}}),Object(ne.jsx)(de.CalciteH3,{children:"Error"}),Object(ne.jsx)(de.CalciteP,{children:l}),Object(ne.jsx)(Ae,{schools:o,schoolField:c.schoolNameFieldEsri})]}):Object(ne.jsxs)(ke,{style:{alignItems:"center"},children:[Object(ne.jsx)(Be.a,{size:100,color:"green",style:{margin:"auto"}}),Object(ne.jsx)(de.CalciteH3,{children:"Success! All ".concat(r.length," schools updated.")})]})},Te=function(e){var t=e.account,n=e.appConfig,c=e.attemptLogout,l=o.a.useState(!1),s=Object(j.a)(l,2),u=s[0],d=s[1],f=o.a.useState(null),b=Object(j.a)(f,2),x=b[0],O=b[1],m=Object(i.useState)([]),v=Object(j.a)(m,2),w=v[0],y=v[1],S=Object(i.useState)([]),k=Object(j.a)(S,2),C=k[0],B=k[1],L=Object(i.useState)(1),_=Object(j.a)(L,2),D=_[0],E=_[1],P=Object(i.useState)(null),A=Object(j.a)(P,2),F=A[0],T=A[1],U=Object(i.useMemo)((function(){return new h.a(t)}),[t]);Object(i.useEffect)((function(){var e=function(){var e=Object(r.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(p.a)({authentication:U,url:n.featureServiceURL});case 3:(t=e.sent)&&t.fields&&B(t.fields.filter((function(e){return w[0].hasOwnProperty(e.alias)}))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),O("Error Saving Data. (Fields)");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();w.length&&e()}),[w,U,n]);var R=function(){var e=Object(r.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.next=3,g({rows:w,fields:C,userSession:U,featureLayerUrl:n.featureServiceURL});case 3:t=e.sent,T(t),E(D+1),d(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ne.jsx)(ie.Provider,{value:{loading:u,setLoading:d,error:x,setError:O,data:w,setData:y,config:n},children:Object(ne.jsxs)("div",{children:[Object(ne.jsx)(ce,{account:t,attemptLogout:c}),Object(ne.jsxs)(be,{children:[Object(ne.jsx)(ge,{children:Object(ne.jsxs)(K.a,{currentStep:D,children:[Object(ne.jsxs)(W.Step,{children:[Object(ne.jsx)(W.StepTitle,{children:"Download"}),Object(ne.jsx)(W.StepDescription,{children:"Download the Excel template to report school data."})]}),Object(ne.jsxs)(W.Step,{error:x&&2===D,children:[Object(ne.jsx)(W.StepTitle,{children:"Upload"}),Object(ne.jsx)(W.StepDescription,{children:x&&1===D?x:"Upload the excel template populated with your schools information."})]}),Object(ne.jsxs)(W.Step,{children:[Object(ne.jsx)(W.StepTitle,{children:"Summary"}),Object(ne.jsx)(W.StepDescription,{children:"Summary of your submitted school data."})]})]})}),Object(ne.jsxs)(xe,{children:[u&&Object(ne.jsx)(q.a,{sizeRatio:2,style:{position:"absolute",top:"30%",left:"50%"}},"uploadLoader"),1===D&&Object(ne.jsx)(Se,{fileUrl:n.templateUrl}),2===D&&Object(ne.jsx)(he,{}),3===D&&Object(ne.jsx)(Fe,{results:F})]}),Object(ne.jsx)(Oe,{children:Object(ne.jsxs)("div",{children:[2===D?Object(ne.jsx)(G.a,{clear:!0,onClick:function(){E(D-1)},style:{marginRight:".5rem"},children:"Previous"}):"",Object(ne.jsx)(G.a,{disabled:2===D&&(!w||!w.length),onClick:function(){1===D?E(D+1):2===D?R():(y([]),E(1))},children:["Next","Submit","Restart"][D-1]})]})})]})]})})},Ue=n.p+"static/media/splashBackground.5204fcdc.jpg",Re=X.default.div(z||(z=Object(Q.a)(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  background: url(",") center/cover\n    no-repeat;\n"])),(function(e){return e.error?"":Ue})),Me=Object(X.default)(pe.a)(H||(H=Object(Q.a)(["\n  width: 350px;\n"]))),ze=X.default.div(N||(N=Object(Q.a)(["\n  text-align: center;\n"]))),He=X.default.img(I||(I=Object(Q.a)(["\n  width: 177px;\n"]))),Ne=Object(X.default)(G.a)(Y||(Y=Object(Q.a)(["\n  margin-top: 1rem;\n  background-color: #1b449d;\n"]))),Ie=function(e){var t=e.attemptLogin;return Object(ne.jsx)(Re,{children:Object(ne.jsx)(Me,{open:!0,appElement:document.body,overlayStyle:{background:"unset"},children:Object(ne.jsxs)(ze,{children:[Object(ne.jsx)(He,{src:"https://california.maps.arcgis.com/sharing/rest/content/items/eabecb26ec754b849c44175495e31e66/data",alt:"App Logo"}),Object(ne.jsx)(de.CalciteP,{children:"Login to upload school data."}),Object(ne.jsx)(Ne,{fullWidth:!0,onClick:t,children:"Proceed to Login"})]})})})},Ye=function(e){var t=e.config,n=Object(u.a)(Object(u.a)({},t.authInfo),{redirectUri:window.location.href}),c=Object(d.useAccountManager)(n),a=c.accountManagerState,r=c.addAccount,i=c.logoutAccount,o=a.active,l=a.accounts;return console.log(a),o&&l[o]&&l[o].session?Object(ne.jsx)(Te,{appConfig:t,account:l[o],userSession:new h.a(l[o].session),attemptLogout:function(){i(l[o])}}):Object(ne.jsx)(Ie,{attemptLogin:function(){r(n)}})},Ve=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,263)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))},Ge=(n(256),n(18)),Je=n.n(Ge),qe=Ge.CalciteTheme;qe.palette.Brand_Blue_200="#1f2574",qe.palette.blue="#1f2574",qe.palette.lightBlue="#5258A7",qe.palette.darkBlue="#5258A7",console.log(qe),function(){var e=Object(r.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("".concat("/ca-safe-schools/data-upload","/config.json"));case 2:t=e.sent,s.a.render(Object(ne.jsx)(o.a.StrictMode,{children:Object(ne.jsx)(Je.a,{children:Object(ne.jsx)(Ye,{config:t})})}),document.getElementById("root"));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),Ve()}},[[257,1,2]]]);
//# sourceMappingURL=main.8225f7c5.chunk.js.map